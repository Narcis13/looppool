---
phase: 04-workflow-integration
plan: 04
type: execute
wave: 2
depends_on: []
files_modified:
  - get-shit-done/workflows/discovery-phase.md
  - commands/gsd/debug.md
  - commands/gsd/resume-work.md
autonomous: true

must_haves:
  truths:
    - "discovery-phase handles confidence gate autonomously when enabled"
    - "debug handles checkpoint responses autonomously when enabled"
    - "resume-work auto-selects most recent session when enabled"
    - "All interactive paths remain unchanged when autonomous disabled"
  artifacts:
    - path: "get-shit-done/workflows/discovery-phase.md"
      provides: "Autonomous confidence gate handling"
      contains: "AUTONOMOUS="
    - path: "commands/gsd/debug.md"
      provides: "Autonomous checkpoint handling"
      contains: "AUTONOMOUS="
    - path: "commands/gsd/resume-work.md"
      provides: "Autonomous session selection"
      contains: "AUTONOMOUS="
  key_links:
    - from: "get-shit-done/workflows/discovery-phase.md"
      to: "get-shit-done/references/autonomous.md"
      via: "autonomous wrapper pattern"
      pattern: "Auto-decided:"
---

<objective>
Add autonomous handling to auxiliary workflows: discovery-phase (confidence gate), debug (checkpoint handling), and resume-work (session selection).

Purpose: FLOW-04 requires all GSD workflows to check autonomous flag before AskUserQuestion. These auxiliary workflows have decision points that should be auto-decided when autonomous enabled.

Output: Three workflows with autonomous flag reading and auto-decision handling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/autonomous.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

From 04-RESEARCH.md:
- discovery-phase: Handle confidence gate autonomously (proceed anyway for LOW confidence)
- debug: Handle checkpoint responses autonomously
- resume-work: Auto-select most recent session

LOW priority but needed for FLOW-04 completeness.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add autonomous handling to discovery-phase workflow</name>
  <files>get-shit-done/workflows/discovery-phase.md</files>
  <action>
Add autonomous flag reading step at the beginning of `<process>` section, before determine_depth:

```markdown
<step name="check_autonomous_mode" priority="first">
Read autonomous mode setting:

```bash
AUTONOMOUS=$(cat .planning/config.json 2>/dev/null | grep -o '"autonomous"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "false")
```

Store for use in confidence_gate and open_questions_gate steps below.
</step>
```

Modify `confidence_gate` step to add autonomous handling:

```markdown
<step name="confidence_gate">
After creating DISCOVERY.md, check confidence level.

**If AUTONOMOUS=true:**

Auto-proceed regardless of confidence level. Discovery is informational, not blocking.

If confidence is LOW:
```
Auto-decided: proceed with low confidence -- Autonomous mode, discovery informs but doesn't block [autonomous-defaults.md]
```

If confidence is MEDIUM or HIGH:
```
Auto-decided: proceed -- Discovery complete ({confidence} confidence) [autonomous-defaults.md]
```

Continue to open_questions_gate.

**If AUTONOMOUS=false:**

If confidence is LOW:
Use AskUserQuestion:

- header: "Low Confidence"
- question: "Discovery confidence is LOW: [reason]. How would you like to proceed?"
- options:
  - "Dig deeper" - Do more research before planning
  - "Proceed anyway" - Accept uncertainty, plan with caveats
  - "Pause" - I need to think about this

If confidence is MEDIUM:
Inline: "Discovery complete (medium confidence). [brief reason]. Proceed to planning?"

If confidence is HIGH:
Proceed directly, just note: "Discovery complete (high confidence)."
</step>
```

Modify `open_questions_gate` step to add autonomous handling:

```markdown
<step name="open_questions_gate">
If DISCOVERY.md has open_questions:

**If AUTONOMOUS=true:**

```
Auto-decided: proceed with open questions -- Questions logged in DISCOVERY.md for later [autonomous-defaults.md]
```

Open questions remain documented but don't block autonomous planning.

Continue to offer_next.

**If AUTONOMOUS=false:**

Present them inline:
"Open questions from discovery:

- [Question 1]
- [Question 2]

These may affect implementation. Acknowledge and proceed? (yes / address first)"

If "address first": Gather user input on questions, update discovery.
</step>
```
  </action>
  <verify>
grep "AUTONOMOUS=" get-shit-done/workflows/discovery-phase.md
grep "Auto-decided:" get-shit-done/workflows/discovery-phase.md | head -3
  </verify>
  <done>
discovery-phase has autonomous handling for confidence_gate and open_questions_gate.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add autonomous handling to debug command</name>
  <files>commands/gsd/debug.md</files>
  <action>
Add autonomous.md reference to allowed-tools is not needed, but add autonomous flag reading.

In step 0 (Resolve Model Profile), add after reading model profile:

```markdown
## 0. Resolve Model Profile

Read model profile for agent spawning:
[... existing code ...]

**Read autonomous mode:**

```bash
AUTONOMOUS=$(cat .planning/config.json 2>/dev/null | grep -o '"autonomous"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "false")
```

Store for use in checkpoint handling below.
```

Modify step 4 (Handle Agent Return) for the CHECKPOINT REACHED case:

```markdown
**If `## CHECKPOINT REACHED`:**

**If AUTONOMOUS=true:**

Auto-respond based on checkpoint type:
- human-verify: Approve and continue
- decision: Select safest/default option
- human-action: Cannot auto-complete, fall back to human

```
Auto-decided: {response} -- Checkpoint {type} auto-handled [autonomous-defaults.md]
```

Spawn continuation agent (see step 5)

**If AUTONOMOUS=false:**

- Present checkpoint details to user
- Get user response
- Spawn continuation agent (see step 5)
```
  </action>
  <verify>
grep "AUTONOMOUS=" commands/gsd/debug.md
grep "Auto-decided:" commands/gsd/debug.md
  </verify>
  <done>
debug command has autonomous handling for checkpoint responses.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add autonomous handling to resume-work command</name>
  <files>commands/gsd/resume-work.md</files>
  <action>
The resume-work command is minimal (delegates to workflow). Add autonomous handling inline.

Add after the objective section and before execution_context:

In the process section, add autonomous handling note:

```markdown
<process>
**Check autonomous mode:**

```bash
AUTONOMOUS=$(cat .planning/config.json 2>/dev/null | grep -o '"autonomous"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "false")
```

**If AUTONOMOUS=true:**

If multiple sessions exist, auto-select most recent:

```
Auto-decided: resume most recent session -- Autonomous mode, selecting latest [autonomous-defaults.md]
```

**If AUTONOMOUS=false:**

Follow the resume-project workflow from `@~/.claude/get-shit-done/workflows/resume-project.md`.
[... rest unchanged ...]
</process>
```
  </action>
  <verify>
grep "AUTONOMOUS=" commands/gsd/resume-work.md
grep "Auto-decided:" commands/gsd/resume-work.md
  </verify>
  <done>
resume-work has autonomous handling for session selection.
  </done>
</task>

</tasks>

<verification>
1. grep confirms AUTONOMOUS flag reading in all three files
2. grep confirms Auto-decided traces in all three files
3. Interactive paths unchanged when AUTONOMOUS=false
4. Patterns consistent with Phase 3 established conventions
</verification>

<success_criteria>
- [ ] discovery-phase confidence_gate and open_questions_gate have autonomous handling
- [ ] debug checkpoint handling has autonomous handling
- [ ] resume-work session selection has autonomous handling
- [ ] All three files read AUTONOMOUS flag
- [ ] All interactive paths unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/04-workflow-integration/04-04-SUMMARY.md`
</output>
