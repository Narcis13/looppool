---
phase: 01-inner-voice-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - get-shit-done/workflows/execute-plan.md
autonomous: true

must_haves:
  truths:
    - "execute-plan.md reads autonomous flag at workflow start"
    - "Checkpoint handling outputs decision traces when autonomous"
    - "checkpoint:human-verify auto-approves when all verifications pass"
    - "checkpoint:decision selects option based on context"
    - "checkpoint:human-action falls back to human even in autonomous mode"
    - "Interactive mode remains unchanged when autonomous=false"
  artifacts:
    - path: "get-shit-done/workflows/execute-plan.md"
      provides: "Core plan execution with autonomous checkpoint handling"
      contains: "AUTONOMOUS="
  key_links:
    - from: "get-shit-done/workflows/execute-plan.md"
      to: "get-shit-done/references/autonomous.md"
      via: "references autonomous patterns"
      pattern: "@.*references/autonomous.md"
    - from: "get-shit-done/workflows/execute-plan.md"
      to: "get-shit-done/references/autonomous-defaults.md"
      via: "references defaults"
      pattern: "@.*references/autonomous-defaults.md"
---

<objective>
Integrate autonomous checkpoint handling into execute-plan.md, the core workflow that runs plan tasks. When autonomous mode is enabled, checkpoints are handled automatically using the patterns from Plan 01.

Purpose: execute-plan.md is the primary workflow where checkpoints are encountered. Implementing autonomous handling here covers the core execution path (FLOW-03 prep). Other workflows will be integrated in Phase 4.

Output: Updated execute-plan.md that reads the autonomous flag, handles checkpoints autonomously when enabled, and preserves interactive mode when disabled.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-inner-voice-foundation/01-RESEARCH.md
@.planning/phases/01-inner-voice-foundation/01-01-SUMMARY.md
@get-shit-done/references/autonomous.md
@get-shit-done/references/autonomous-defaults.md
@get-shit-done/references/checkpoints.md
@get-shit-done/workflows/execute-plan.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add autonomous flag reading to execute-plan.md</name>
  <files>get-shit-done/workflows/execute-plan.md</files>
  <action>
Add a step early in execute-plan.md (after loading config, before execution begins) that reads the autonomous flag.

Find the existing config loading section (look for MODEL_PROFILE or similar config reads) and add:

```markdown
<step name="check_autonomous_mode">
Read autonomous mode setting:

```bash
AUTONOMOUS=$(cat .planning/config.json 2>/dev/null | grep -o '"autonomous"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "false")
```

Store for use in checkpoint handling. When `AUTONOMOUS=true`, checkpoints will be handled automatically using documented patterns.

Reference: @get-shit-done/references/autonomous.md
</step>
```

Place this step AFTER config loading but BEFORE task execution begins.

Do NOT modify any existing steps yet - just add the flag reading step.
  </action>
  <verify>
grep -n "AUTONOMOUS=" get-shit-done/workflows/execute-plan.md shows the new step exists.
grep -n "check_autonomous_mode" get-shit-done/workflows/execute-plan.md confirms step name.
  </verify>
  <done>execute-plan.md reads the autonomous flag early in the workflow.</done>
</task>

<task type="auto">
  <name>Task 2: Update checkpoint handling for autonomous mode</name>
  <files>get-shit-done/workflows/execute-plan.md</files>
  <action>
Find the checkpoint handling section in execute-plan.md (search for "checkpoint:human-verify", "checkpoint:decision", or "checkpoint:human-action") and add autonomous handling.

For the checkpoint handling step/section, add the autonomous wrapper pattern:

```markdown
### Autonomous Checkpoint Handling

**If AUTONOMOUS=true:**

Reference: @get-shit-done/references/autonomous-defaults.md

**For checkpoint:human-verify:**
1. Run all automated verifications specified in the task (tests, builds, curl checks)
2. If ALL pass:
   ```
   Auto-decided: approved — All verification checks passed [list results]
   ```
   Continue to next task.
3. If ANY fail: Fall back to human verification (present checkpoint even in autonomous mode)

**For checkpoint:decision:**
1. Read available options from task
2. Check project context (PROJECT.md, REQUIREMENTS.md, current stack)
3. Select option that best matches context
   ```
   Auto-decided: [option] — [context-based reason]
   ```
   Continue with selected option.
4. If no clear match: Select safest/most reversible option with assumption logged

**For checkpoint:human-action:**
1. Cannot be automated (requires human-only action)
   ```
   Autonomous mode: Human action required for [action], pausing for user
   ```
2. Present checkpoint and wait for user (same as interactive mode)

**If AUTONOMOUS=false:**

[Preserve existing checkpoint handling unchanged - no modifications to interactive behavior]
```

The key principle: add the autonomous handling as a conditional BEFORE the existing interactive handling. The existing code paths must remain untouched.

Update the execution_context section to reference the autonomous references:
```markdown
<execution_context>
@~/.claude/get-shit-done/references/autonomous.md
@~/.claude/get-shit-done/references/autonomous-defaults.md
@~/.claude/get-shit-done/references/checkpoints.md
...existing references...
</execution_context>
```
  </action>
  <verify>
grep -n "checkpoint:human-verify" get-shit-done/workflows/execute-plan.md shows autonomous handling.
grep -n "Auto-decided:" get-shit-done/workflows/execute-plan.md confirms trace format.
grep -n "AUTONOMOUS=false" get-shit-done/workflows/execute-plan.md confirms interactive path preserved.
grep -n "references/autonomous" get-shit-done/workflows/execute-plan.md confirms references added.
  </verify>
  <done>execute-plan.md handles checkpoints autonomously when enabled, preserves interactive mode when disabled.</done>
</task>

<task type="auto">
  <name>Task 3: Add autonomous verification failure handling</name>
  <files>get-shit-done/workflows/execute-plan.md</files>
  <action>
Find the verification failure handling section in execute-plan.md (where task verification fails) and add autonomous handling.

For verification failures, add:

```markdown
### Autonomous Verification Failure Handling

**If AUTONOMOUS=true and task verification fails:**

1. Analyze failure output to determine if recoverable
2. If recoverable (syntax error, missing import, typo):
   ```
   Auto-decided: retry — Verification failed due to [issue], attempting fix
   ```
   Apply fix and retry (max 2 retries).
3. If not recoverable after retries or issue is unclear:
   ```
   Autonomous mode: Verification failed for [task], falling back to human review
   ```
   Present failure details and wait for user input.

**If AUTONOMOUS=false:**

[Preserve existing verification failure handling unchanged]
```

Key principle: autonomous mode should attempt to self-correct for minor issues but fall back to human for persistent or unclear failures. Never silently skip failures.
  </action>
  <verify>
grep -n "retry" get-shit-done/workflows/execute-plan.md shows retry handling exists.
grep -n "falling back to human" get-shit-done/workflows/execute-plan.md confirms fallback documented.
  </verify>
  <done>execute-plan.md handles verification failures autonomously with retry and fallback to human.</done>
</task>

</tasks>

<verification>
1. execute-plan.md reads autonomous flag at workflow start
2. All three checkpoint types have autonomous handling documented
3. Interactive mode (AUTONOMOUS=false) code paths unchanged
4. Decision traces follow the documented format
5. Graceful degradation to human for failures that can't be auto-resolved
6. References to autonomous.md and autonomous-defaults.md added
</verification>

<success_criteria>
- [ ] AUTONOMOUS flag read early in execute-plan.md workflow
- [ ] checkpoint:human-verify auto-approves when verifications pass
- [ ] checkpoint:decision selects option based on context
- [ ] checkpoint:human-action falls back to human
- [ ] Verification failures retry then fall back to human
- [ ] All autonomous handling outputs decision traces
- [ ] Interactive mode remains completely unchanged
- [ ] References to autonomous documentation added
</success_criteria>

<output>
After completion, create `.planning/phases/01-inner-voice-foundation/01-02-SUMMARY.md`
</output>
