---
phase: 03-decision-policies
plan: 03
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - commands/gsd/plan-phase.md
  - get-shit-done/workflows/execute-plan.md
autonomous: true

must_haves:
  truths:
    - "POLICY-05 auto-approves plans when checker passes"
    - "POLICY-06 is referenced for checkpoint:decision handling"
    - "POLICY-07 is referenced for checkpoint:human-verify handling"
  artifacts:
    - path: "commands/gsd/plan-phase.md"
      provides: "Autonomous plan approval using POLICY-05"
      contains: "POLICY-05"
    - path: "get-shit-done/workflows/execute-plan.md"
      provides: "Policy references for checkpoint handling"
      contains: "POLICY-06"
  key_links:
    - from: "commands/gsd/plan-phase.md"
      to: "get-shit-done/references/decision-policies.md"
      via: "reference to POLICY-05"
      pattern: "decision-policies.md"
    - from: "get-shit-done/workflows/execute-plan.md"
      to: "get-shit-done/references/decision-policies.md"
      via: "reference to POLICY-06, POLICY-07"
      pattern: "POLICY-0[67]"
---

<objective>
Integrate POLICY-05 into plan-phase.md and add policy references to execute-plan.md for POLICY-06 and POLICY-07.

Purpose: Complete policy coverage for all GSD decision points. Plan approval uses POLICY-05; checkpoint handling references POLICY-06/07 (which are already implemented in execute-plan.md checkpoint_protocol).

Output: Updated plan-phase.md with POLICY-05 autonomous handling, and execute-plan.md with explicit policy references in checkpoint_protocol.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-decision-policies/03-01-SUMMARY.md

Reference:
@commands/gsd/plan-phase.md
@get-shit-done/workflows/execute-plan.md
@get-shit-done/references/decision-policies.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add POLICY-05 to plan-phase.md</name>
  <files>commands/gsd/plan-phase.md</files>
  <action>
Update `commands/gsd/plan-phase.md` to add POLICY-05 for autonomous plan approval.

**Step 1: Add execution_context reference**

Add to the `<execution_context>` section:
```markdown
@~/.claude/get-shit-done/references/decision-policies.md
```

**Step 2: Add autonomous flag reading**

After step 1 (Validate Environment), add autonomous check:
```markdown
**Check autonomous mode:**
```bash
AUTONOMOUS=$(cat .planning/config.json 2>/dev/null | grep -o '"autonomous"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "false")
```
Store for use in plan approval.
```

**Step 3: Update verification loop (after checker returns)**

Find the section where checker output is processed (around step 11) and add POLICY-05:

```markdown
## 11. Handle Checker Return

After gsd-plan-checker returns:

**If AUTONOMOUS=true:**

Apply POLICY-05 (Plan Approval):

1. Check checker output:
   ```bash
   echo "$CHECKER_OUTPUT" | grep -q "## VERIFICATION PASSED"
   CHECKER_PASSED=$?
   ```

2. Apply policy:
   - If CHECKER_PASSED=0 (grep found match):
     ```
     Auto-decided: approve plans -- Checker passed verification [POLICY-05, VERIFICATION PASSED]
     ```
     Proceed to completion. Display:
     ```
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
      GSD PLANNING COMPLETE
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

     Phase: {phase_number}: {phase_name}
     Plans: {count} plan(s) in {wave_count} wave(s)
     ```

   - If checker returns "## ISSUES FOUND":
     ```
     Auto-decided: revision required -- Checker found issues, iteration {N}/{max} [POLICY-05]
     ```
     Trigger revision loop (spawn planner in revision mode).
     After max iterations (3), fall back to human:
     ```
     Auto-decided: human review -- Max revision iterations reached [POLICY-05, fallback]
     ```

   - If checker returns neither (unexpected output):
     ```
     Auto-decided: human review -- Unexpected checker output [POLICY-05, fallback]
     ```
     Fall back to human review.

**If AUTONOMOUS=false:**

**`## VERIFICATION PASSED`:**
- Display: `Plans verified. Phase {X} ready for execution.`
- Offer: 1) Execute phase now (`/gsd:execute-phase`), 2) Review plans first, 3) Exit
- Wait for user choice

**`## ISSUES FOUND`:**
- Display checker issues clearly
- Offer: 1) Auto-fix (trigger planner revision), 2) Manual review, 3) Proceed anyway
- Wait for user choice
```

Note: Preserve existing interactive logic exactly. Only add autonomous wrapper.
  </action>
  <verify>
Reference added: `grep -q "decision-policies.md" commands/gsd/plan-phase.md`
Autonomous flag: `grep -q "AUTONOMOUS=" commands/gsd/plan-phase.md`
POLICY-05 integrated: `grep -q "POLICY-05" commands/gsd/plan-phase.md`
Verification loop: `grep -q "VERIFICATION PASSED" commands/gsd/plan-phase.md`
  </verify>
  <done>
plan-phase.md has autonomous flag reading and POLICY-05 for plan approval, with preserved interactive paths.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add explicit POLICY-06/07 references to execute-plan.md</name>
  <files>get-shit-done/workflows/execute-plan.md</files>
  <action>
Update `get-shit-done/workflows/execute-plan.md` to add explicit policy references in checkpoint_protocol.

Note: The checkpoint handling logic already exists from Phase 2. This task adds explicit POLICY-06 and POLICY-07 references to the trace outputs and documentation.

**Step 1: Add execution_context reference**

Add to `<required_reading>` section (if not already present):
```markdown
@~/.claude/get-shit-done/references/decision-policies.md
```

**Step 2: Update checkpoint:human-verify section with POLICY-07 reference**

Find the autonomous handling for checkpoint:human-verify and update trace to include POLICY-07:

```markdown
**For checkpoint:human-verify:**
1. Run all automated verifications specified in the task (tests, builds, curl checks)
2. If ALL pass:
   ```
   Auto-decided: approved -- All verification checks passed [POLICY-07, tests: {pass}/{total}, build: success]
   ```

   **Persist decision to DECISIONS.md:**
   [existing persistence code]

3. If ANY fail: Fall back to human verification (present checkpoint even in autonomous mode)
   ```
   Verification failed -- Falling back to human [POLICY-07, test failures: {count}]
   ```
```

**Step 3: Update checkpoint:decision section with POLICY-06 reference**

Find the autonomous handling for checkpoint:decision and update to include POLICY-06:

```markdown
**For checkpoint:decision:**

**Step 1: Gather decision context** (per context-assembly.md):
[existing context gathering]

**Step 2: Check session history before deciding:**
[existing history check]

**Step 3: Apply POLICY-06 (Checkpoint Decision Selection):**

1. If explicit preference found in context:
   ```
   Auto-decided: {option} -- {reason} [POLICY-06, {context_refs}, HIGH]
   ```

2. If research recommendation found:
   ```
   Auto-decided: {option} -- {reason} [POLICY-06, {context_refs}, MEDIUM]
   ```

3. If no clear match (use safest option):
   ```
   Auto-decided: {option} -- No policy match, selected safest option [POLICY-06, Assumption: {assumption}, LOW]
   ```

**Step 4: Determine confidence level:**
[existing confidence logic]

**Step 5: Persist decision to DECISIONS.md:**
[existing persistence code]
```

**Step 4: Add policy reference in autonomous mode initialization**

In the check_autonomous_mode step, add note:
```markdown
When `AUTONOMOUS=true`:
- checkpoint:human-verify uses POLICY-07 (auto-approve if all checks pass)
- checkpoint:decision uses POLICY-06 (context-based selection)
- checkpoint:human-action always requires human (cannot be automated)

Reference: @~/.claude/get-shit-done/references/decision-policies.md
```
  </action>
  <verify>
Reference added: `grep -q "decision-policies.md" get-shit-done/workflows/execute-plan.md`
POLICY-06 referenced: `grep -q "POLICY-06" get-shit-done/workflows/execute-plan.md`
POLICY-07 referenced: `grep -q "POLICY-07" get-shit-done/workflows/execute-plan.md`
Trace formats include policy: `grep "Auto-decided.*POLICY-0[67]" get-shit-done/workflows/execute-plan.md`
  </verify>
  <done>
execute-plan.md has explicit POLICY-06 and POLICY-07 references in checkpoint_protocol, making the policy application visible and traceable.
  </done>
</task>

</tasks>

<verification>
- [ ] plan-phase.md has autonomous flag reading
- [ ] POLICY-05 applied in checker result handling
- [ ] execute-plan.md references decision-policies.md
- [ ] POLICY-06 explicitly referenced in checkpoint:decision handling
- [ ] POLICY-07 explicitly referenced in checkpoint:human-verify handling
- [ ] All trace outputs include [POLICY-XX] reference
- [ ] All interactive paths preserved unchanged
</verification>

<success_criteria>
All 7 policies are now integrated into GSD workflows:
- POLICY-01-04: new-project.md (Plan 02)
- POLICY-05: plan-phase.md (this plan)
- POLICY-06-07: execute-plan.md (this plan)

Every autonomous decision traces back to a specific policy, enabling auditability.
</success_criteria>

<output>
After completion, create `.planning/phases/03-decision-policies/03-03-SUMMARY.md`
</output>
