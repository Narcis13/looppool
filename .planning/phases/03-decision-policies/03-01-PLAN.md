---
phase: 03-decision-policies
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/references/decision-policies.md
autonomous: true

must_haves:
  truths:
    - "All 7 policies are defined in standardized format"
    - "Each policy has observable condition checks"
    - "Each policy has trace output format"
    - "Policies are declarative rules, not reasoning processes"
  artifacts:
    - path: "get-shit-done/references/decision-policies.md"
      provides: "Central policy definitions for autonomous decisions"
      min_lines: 300
      contains: "POLICY-01"
  key_links:
    - from: "decision-policies.md"
      to: "autonomous.md"
      via: "references and extends autonomous pattern"
      pattern: "autonomous"
---

<objective>
Create the centralized decision-policies.md reference document defining all 7 autonomous decision policies.

Purpose: Establish the single source of truth for what to decide at each GSD decision point. Workflows reference this document; they don't define policies inline.

Output: `get-shit-done/references/decision-policies.md` with complete policy definitions for POLICY-01 through POLICY-07.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-decision-policies/03-RESEARCH.md

Reference existing patterns from:
@get-shit-done/references/autonomous.md
@get-shit-done/references/autonomous-defaults.md
@get-shit-done/references/context-assembly.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create decision-policies.md with all 7 policy definitions</name>
  <files>get-shit-done/references/decision-policies.md</files>
  <action>
Create `get-shit-done/references/decision-policies.md` with:

**Document structure:**
1. Overview section explaining what policies are (declarative rules, not reasoning)
2. Policy format reference (standard structure for all policies)
3. All 7 policies in standardized format:

**For each policy, include:**
- Decision point: Where this policy applies (which workflow/command)
- Applies when: Conditions that trigger this policy
- Policy rule: IF [observable conditions] THEN [choice] BECAUSE [rationale]
- Observable condition check: Actual bash/grep commands to evaluate conditions
- Trace output format: Exact trace line format
- Confidence level: HIGH/MEDIUM/LOW and what determines each
- Fallback behavior: What to do when conditions are ambiguous

**Policy definitions (from research):**

POLICY-01 (Brownfield Detection):
- Decision point: `/gsd:new-project` Phase 2
- IF code files exist AND no codebase map THEN trigger codebase mapping
- Check: `find . -name "*.ts" -o -name "*.js" -o -name "*.py" | grep -v node_modules | head -1` and `[ -d .planning/codebase ]`
- Trace: `Auto-decided: map codebase -- Code exists without map [POLICY-01, file: {detected_file}]`

POLICY-02 (Research Toggle):
- Decision point: `/gsd:new-project` Phase 6
- IF config.research=true AND greenfield THEN research enabled
- Check: `grep -o '"research"' .planning/config.json` and `[ ! -d .planning/codebase ]`
- Trace: `Auto-decided: research enabled -- Greenfield project [POLICY-02, config: workflow.research=true]`

POLICY-03 (Feature Scoping):
- Decision point: `/gsd:new-project` Phase 7
- IF feature in "Table stakes" OR in PROJECT.md THEN classify v1
- Check: grep commands against FEATURES.md and PROJECT.md
- Trace: `Auto-decided: v1 -- Table stakes feature ({feature}) [POLICY-03, FEATURES.md:Table stakes]`

POLICY-04 (Roadmap Approval):
- Decision point: `/gsd:new-project` Phase 8
- IF 100% coverage AND no unmapped requirements THEN auto-approve
- Check: `grep -c "Pending" .planning/REQUIREMENTS.md` = 0
- Trace: `Auto-decided: approve roadmap -- 100% requirement coverage [POLICY-04, {count}/{count} mapped]`

POLICY-05 (Plan Approval):
- Decision point: `/gsd:plan-phase` Step 11
- IF checker returns "VERIFICATION PASSED" THEN approve
- Check: `echo "$CHECKER_OUTPUT" | grep -q "## VERIFICATION PASSED"`
- Trace: `Auto-decided: approve plans -- Checker passed [POLICY-05, VERIFICATION PASSED]`

POLICY-06 (Checkpoint Decision Selection):
- Decision point: execute-plan.md checkpoint:decision
- IF context explicitly addresses decision THEN select matching option
- Uses context assembly pattern (PROJECT.md -> REQUIREMENTS.md -> session history -> RESEARCH.md)
- Trace: `Auto-decided: {option} -- {reason} [POLICY-06, {context_refs}, {confidence}]`

POLICY-07 (Checkpoint Human-Verify Auto-Approval):
- Decision point: execute-plan.md checkpoint:human-verify
- IF all automated verifications pass THEN approve
- Check: test exit code, build exit code, endpoint checks
- Trace: `Auto-decided: approved -- All verification checks passed [POLICY-07, tests: {pass}/{total}, build: success]`

**Include Quick Reference Table:**
| Policy | Decision Point | Observable Condition | Choice |
|--------|----------------|---------------------|--------|
| POLICY-01 | new-project brownfield | code exists AND no map | trigger mapping |
| ... | ... | ... | ... |

**Include See Also section:**
- autonomous.md (config flag reading, decision wrapper)
- autonomous-defaults.md (fallback behaviors)
- context-assembly.md (context gathering for POLICY-06)
  </action>
  <verify>
File exists: `ls get-shit-done/references/decision-policies.md`
Contains all policies: `grep -c "## POLICY-0" get-shit-done/references/decision-policies.md` returns 7
Each policy has condition check: `grep -c "Observable condition check" get-shit-done/references/decision-policies.md` returns 7
Each policy has trace format: `grep -c "Trace output" get-shit-done/references/decision-policies.md` returns 7
  </verify>
  <done>
decision-policies.md exists with all 7 policies defined in standardized format, each with observable condition checks, trace formats, confidence levels, and fallback behaviors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add policy integration patterns section</name>
  <files>get-shit-done/references/decision-policies.md</files>
  <action>
Add a "Policy Integration Patterns" section to decision-policies.md showing how workflows apply policies.

**Pattern 1: Simple binary policy (POLICY-01, 05, 07)**
```markdown
<step name="decision_point">
**If AUTONOMOUS=true:**

1. Check observable conditions:
   ```bash
   [condition check commands]
   ```

2. Apply POLICY-XX:
   IF [condition true]
   THEN [choice]
   ```
   Auto-decided: [choice] -- [reason] [POLICY-XX, {details}]
   ```
   Execute choice.

   IF [condition false]
   THEN [alternative]
   ```
   Auto-decided: [alternative] -- [reason] [POLICY-XX]
   ```

**If AUTONOMOUS=false:**
[Existing interactive flow - unchanged]
</step>
```

**Pattern 2: Context-based policy (POLICY-06)**
```markdown
1. Gather decision context (per context-assembly.md)
2. Match context to available options
3. Select option with highest match
4. Output trace with context citations
5. Record decision in session history
```

**Pattern 3: Verification-based policy (POLICY-07)**
```markdown
1. Run all automated verifications
2. Check all exit codes
3. If ALL pass: auto-approve
4. If ANY fail: fall back to human
```

**Anti-patterns section:**
- DON'T: Define policies inline in workflows
- DON'T: Use reasoning-based conditions ("seems like", "appears to be")
- DON'T: Skip trace output
- DON'T: Apply policy without checking conditions first
  </action>
  <verify>
Section exists: `grep -q "Policy Integration Patterns" get-shit-done/references/decision-policies.md`
Contains patterns: `grep -c "Pattern [0-9]" get-shit-done/references/decision-policies.md` >= 3
Contains anti-patterns: `grep -q "Anti-patterns" get-shit-done/references/decision-policies.md`
  </verify>
  <done>
decision-policies.md includes integration patterns showing how workflows should apply policies, plus anti-patterns to avoid.
  </done>
</task>

</tasks>

<verification>
- [ ] File exists at `get-shit-done/references/decision-policies.md`
- [ ] All 7 policies defined (POLICY-01 through POLICY-07)
- [ ] Each policy has: decision point, applies when, policy rule, observable check, trace format, confidence, fallback
- [ ] Quick reference table included
- [ ] Integration patterns section included
- [ ] See Also section references autonomous.md, autonomous-defaults.md, context-assembly.md
</verification>

<success_criteria>
Complete centralized policy reference that workflows can use to apply autonomous decisions. The document defines WHAT to decide at each point; workflows implement HOW to apply these policies.
</success_criteria>

<output>
After completion, create `.planning/phases/03-decision-policies/03-01-SUMMARY.md`
</output>
