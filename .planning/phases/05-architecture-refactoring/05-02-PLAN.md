---
phase: 05-architecture-refactoring
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/gsd-executor.md
  - get-shit-done/references/executor/deviation-rules.md
  - get-shit-done/references/executor/checkpoint-protocol.md
autonomous: true

must_haves:
  truths:
    - "gsd-executor.md is under 500 lines"
    - "Deviation rules accessible via @ reference"
    - "Checkpoint protocol accessible via @ reference"
  artifacts:
    - path: "get-shit-done/references/executor/deviation-rules.md"
      provides: "Rules 1-4 for handling discovered work during execution"
      min_lines: 130
    - path: "get-shit-done/references/executor/checkpoint-protocol.md"
      provides: "Checkpoint types, return format, continuation handling"
      min_lines: 100
  key_links:
    - from: "agents/gsd-executor.md"
      to: "get-shit-done/references/executor/*.md"
      via: "@ reference paths"
      pattern: "@~/.claude/get-shit-done/references/executor/"
---

<objective>
Extract gsd-executor.md (784 lines) into focused modules under 500 lines each.

Purpose: Reduce executor agent size for maintainability while preserving all functionality through @ references.

Output:
- Slimmed gsd-executor.md (~350-400 lines) with role, execution flow, output formats
- 2 new reference files in get-shit-done/references/executor/
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-architecture-refactoring/05-RESEARCH.md

# Source file to refactor
@~/.claude/agents/gsd-executor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create executor references directory and extract deviation-rules.md</name>
  <files>
    get-shit-done/references/executor/deviation-rules.md
  </files>
  <action>
    Create directory get-shit-done/references/executor/ if not exists.

    Extract <deviation_rules> section (lines ~143-283) into deviation-rules.md:
    - Rule 1: Auto-fix bugs
    - Rule 2: Auto-add missing critical functionality
    - Rule 3: Auto-fix blocking issues
    - Rule 4: Ask about architectural changes
    - Rule priority and edge case guidance

    Create deviation-rules.md with:
    1. Header: "# Executor Deviation Rules Reference"
    2. Introduction explaining when deviations occur
    3. All 4 rules with triggers, actions, examples, processes
    4. Rule priority section
    5. Edge case guidance

    Ensure self-contained - no references to external context.
  </action>
  <verify>
    File exists at get-shit-done/references/executor/deviation-rules.md
    wc -l shows 130-180 lines
    grep -c "RULE" deviation-rules.md returns 4+ matches
  </verify>
  <done>
    deviation-rules.md exists with all 4 deviation rules and priority guidance
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract checkpoint-protocol.md</name>
  <files>
    get-shit-done/references/executor/checkpoint-protocol.md
  </files>
  <action>
    Extract these sections into checkpoint-protocol.md:
    - <checkpoint_protocol> section (lines ~349-441) - types, display format
    - <checkpoint_return_format> section (lines ~443-482) - structured return
    - <continuation_handling> section (lines ~484-508) - resume logic
    - <authentication_gates> section (lines ~285-347) - auth error handling

    Create checkpoint-protocol.md with:
    1. Header: "# Executor Checkpoint Protocol Reference"
    2. Checkpoint Types section (human-verify, decision, human-action)
    3. Display Format section
    4. Return Format section (for orchestrator integration)
    5. Continuation Handling section
    6. Authentication Gates section

    Note: This consolidates checkpoint-related content. Existing checkpoints.md in references/ handles the workflow-level checkpoint patterns; this executor reference handles the agent-level checkpoint execution.
  </action>
  <verify>
    File exists at get-shit-done/references/executor/checkpoint-protocol.md
    wc -l shows 100-150 lines
    Content includes "CHECKPOINT REACHED", "Completed Tasks", "Authentication"
  </verify>
  <done>
    checkpoint-protocol.md exists with checkpoint types, return format, continuation, and auth gates
  </done>
</task>

<task type="auto">
  <name>Task 3: Update gsd-executor.md with @ references</name>
  <files>
    agents/gsd-executor.md
  </files>
  <action>
    Replace extracted sections in gsd-executor.md with @ references:

    1. Replace <deviation_rules> content with:
       <deviation_rules>
       @~/.claude/get-shit-done/references/executor/deviation-rules.md
       </deviation_rules>

    2. Replace <authentication_gates>, <checkpoint_protocol>, <checkpoint_return_format>, and <continuation_handling> sections with single:
       <checkpoint_protocol>
       @~/.claude/get-shit-done/references/executor/checkpoint-protocol.md
       </checkpoint_protocol>

    Keep these sections INLINE (too small to extract or define agent identity):
    - <role> (identity)
    - <execution_flow> (core steps)
    - <tdd_execution> (38 lines)
    - <task_commit_protocol> (58 lines)
    - <summary_creation> (72 lines)
    - <state_updates> (37 lines)
    - <final_commit> (29 lines)
    - <completion_format> (23 lines)
    - <success_criteria> (checklist)

    Result should be ~350-400 lines.
  </action>
  <verify>
    wc -l agents/gsd-executor.md shows under 450 lines
    grep "@~/.claude/get-shit-done/references/executor/" agents/gsd-executor.md returns 2 matches
    All @ reference paths point to files that exist
  </verify>
  <done>
    gsd-executor.md is under 500 lines with @ references to extracted modules
  </done>
</task>

</tasks>

<verification>
1. gsd-executor.md line count under 500
2. Both reference files exist in get-shit-done/references/executor/
3. Each reference file is self-contained
4. @ paths in gsd-executor.md all point to valid files
</verification>

<success_criteria>
- gsd-executor.md reduced from 784 to under 500 lines
- 2 reference files created: deviation-rules.md, checkpoint-protocol.md
- All extracted content preserved in references
- No broken @ paths
- Agent functionality unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/05-architecture-refactoring/05-02-SUMMARY.md`
</output>
