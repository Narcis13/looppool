---
phase: 02-context-aware-reasoning
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - get-shit-done/workflows/execute-plan.md
autonomous: true

must_haves:
  truths:
    - "Autonomous decisions gather context using prioritized pattern before deciding"
    - "Session decision history is maintained and checked before each decision"
    - "All autonomous decisions are persisted to DECISIONS.md"
    - "Decision traces include specific context citations"
    - "Later decisions can reference earlier session decisions"
  artifacts:
    - path: "get-shit-done/workflows/execute-plan.md"
      provides: "Context-aware autonomous checkpoint handling with decision persistence"
      contains: "gather_decision_context"
  key_links:
    - from: "get-shit-done/workflows/execute-plan.md"
      to: "get-shit-done/references/context-assembly.md"
      via: "References context assembly pattern"
      pattern: "context-assembly\\.md"
    - from: "get-shit-done/workflows/execute-plan.md"
      to: ".planning/DECISIONS.md"
      via: "Persists decisions to audit trail"
      pattern: "DECISIONS\\.md"
---

<objective>
Integrate context-aware reasoning into execute-plan.md workflow: add context gathering at decision points, session decision history tracking, and DECISIONS.md persistence.

Purpose: Make autonomous decisions grounded in project context and tracked for consistency. This implements VOICE-03, VOICE-04, and VOICE-06.

Output: Updated execute-plan.md with context-aware autonomous decision handling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 2 Plan 1 outputs (must exist before this plan runs)
@get-shit-done/references/context-assembly.md
@get-shit-done/templates/decisions.md

# Phase 1 reference docs
@get-shit-done/references/autonomous.md
@get-shit-done/references/autonomous-defaults.md

# Current workflow to modify
@get-shit-done/workflows/execute-plan.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add session decision history initialization</name>
  <files>get-shit-done/workflows/execute-plan.md</files>
  <action>
Find the `check_autonomous_mode` step (added in Phase 1, Plan 2) and extend it to:

1. After reading autonomous flag, if AUTONOMOUS=true:
   - Initialize session decision history table (in-memory, embedded in context)
   - Load recent decisions from .planning/DECISIONS.md (tail -30)
   - Start new session in DECISIONS.md with timestamp header

2. Add session decision table template:
```markdown
## Session Decisions (auto-maintained)

| ID | Decision | Choice | Reason | Context |
|----|----------|--------|--------|---------|
```

3. Add bash commands to initialize DECISIONS.md session:
```bash
# Create DECISIONS.md if doesn't exist (use template)
# Add session header: ## Session: [timestamp]
# Add table header row
```

Reference context-assembly.md for the session history format.

Keep interactive mode (AUTONOMOUS=false) unchanged - it has no session history tracking.
  </action>
  <verify>
- grep for "Session Decisions" in execute-plan.md
- grep for "DECISIONS.md" in execute-plan.md
- Step extends check_autonomous_mode
  </verify>
  <done>
Session decision history initialization exists in execute-plan.md, including DECISIONS.md session start.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add context gathering to checkpoint handling</name>
  <files>get-shit-done/workflows/execute-plan.md</files>
  <action>
Find the autonomous checkpoint handling (added in Phase 1, Plan 2) and update to gather context before decisions.

For checkpoint:decision handling in AUTONOMOUS=true branch:

1. Before applying decision policy, add context gathering:
```markdown
**Gather decision context** (per context-assembly.md):

1. Read PROJECT.md: Core Value, Constraints, Key Decisions sections
2. Read REQUIREMENTS.md: Active requirements relevant to this decision
3. Check session decision history for related prior decisions
4. Read RESEARCH.md if exists in phase directory

Stop when context is sufficient for this decision.
```

2. Update decision trace format to include citations:
```
Auto-decided: [choice] — [reason] [context refs]
```

Example:
```
Auto-decided: postgresql — Relational data model required [PROJECT.md:Constraints, REQUIREMENTS.md:VOICE-03]
```

3. Check session history BEFORE making decision:
```markdown
Check session decisions for related choices.
If related decision exists (e.g., S001 chose database type):
  Note for consistency: "consistent with S001" or "overrides S001: [justification]"
```

For checkpoint:human-verify, context gathering is lighter (mainly checking test results).

Reference context-assembly.md for the full pattern.
  </action>
  <verify>
- grep for "context-assembly.md" in execute-plan.md
- grep for "Gather decision context" or similar in checkpoint handling
- grep for pattern showing context refs in trace format
  </verify>
  <done>
Context gathering integrated into autonomous checkpoint handling with citations in traces.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add decision persistence to DECISIONS.md</name>
  <files>get-shit-done/workflows/execute-plan.md</files>
  <action>
After each autonomous decision is made, persist it to DECISIONS.md.

1. Add persistence step after decision trace output:
```markdown
**Persist decision:**

1. Determine next decision ID (D001, D002, etc. within session)
2. Format decision row:
   | D[ID] | [HH:MM:SS] | [decision_point] | [choice] | [reason] | [context_refs] | [confidence] |
3. Append to session decision history (in-memory)
4. Append to .planning/DECISIONS.md
```

2. Add bash command pattern:
```bash
# Append decision to DECISIONS.md
echo "| D${DECISION_ID} | $(date -u +%H:%M:%S) | ${DECISION_POINT} | ${CHOICE} | ${REASON} | ${CONTEXT_REFS} | ${CONFIDENCE} |" >> .planning/DECISIONS.md
```

3. Update session decision history table in context:
```markdown
Add row to "## Session Decisions" table:
| S[ID] | [decision] | [choice] | [reason] | [context] |
```

4. Determine confidence level:
- HIGH: Context explicitly addresses this decision
- MEDIUM: Context provides related guidance
- LOW: Using default, assumption logged

This happens for BOTH checkpoint:decision AND checkpoint:human-verify (when auto-approved).
  </action>
  <verify>
- grep for "Persist decision" or "append.*DECISIONS.md" in execute-plan.md
- grep for "Confidence" or "confidence" in decision handling
- Decision persistence applies to both checkpoint types
  </verify>
  <done>
All autonomous decisions are persisted to DECISIONS.md with structured format including confidence level.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Session initialization exists:
```bash
grep -c "Session Decisions" get-shit-done/workflows/execute-plan.md
```

2. Context gathering exists:
```bash
grep -c "context-assembly\|Gather.*context\|decision context" get-shit-done/workflows/execute-plan.md
```

3. Decision persistence exists:
```bash
grep -c "DECISIONS.md" get-shit-done/workflows/execute-plan.md
```

4. Citation format in traces:
```bash
grep -E "Auto-decided.*\[.*\]" get-shit-done/workflows/execute-plan.md  # Should show context refs
```

5. Reference to context-assembly.md:
```bash
grep "context-assembly.md" get-shit-done/workflows/execute-plan.md
```
</verification>

<success_criteria>
- execute-plan.md initializes session decision history at workflow start (AUTONOMOUS=true)
- Context gathering happens before each autonomous decision
- Decision traces include specific context citations
- All autonomous decisions persisted to DECISIONS.md
- Session decision history enables later decisions to reference earlier ones
- Interactive mode (AUTONOMOUS=false) unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/02-context-aware-reasoning/02-02-SUMMARY.md`
</output>
